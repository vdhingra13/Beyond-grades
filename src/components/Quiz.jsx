import React,{useEffect,useState} from 'react'
export default function Quiz({filePath,titleForEmail}){const [quiz,setQuiz]=useState(null);const [answers,setAnswers]=useState([]);const [submitted,setSubmitted]=useState(false);const [result,setResult]=useState(null);useEffect(()=>{fetch(filePath).then(r=>r.json()).then(setQuiz).catch(console.error)},[filePath]);const select=(i,letter)=>{const c=[...answers];c[i]=letter;setAnswers(c)};const submit=async()=>{const res=await fetch('/api/submit',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({answers,quizPath:filePath,topic:titleForEmail})});const data=await res.json();setResult(data);setSubmitted(true)};if(!quiz)return <div className='container'><p>Loading quiz…</p></div>;const pct=Math.round((answers.filter(Boolean).length/quiz.total_questions)*100);return(<div className='container'><h2>{quiz.title}</h2><p className='muted'>{quiz.description}</p><div className='progress'><div style={{width:pct+'%'}}></div></div>{quiz.questions.map((q,i)=>{const L=['A','B','C','D'];return(<div className='card' key={i}><div style={{fontWeight:600}}>Q{i+1}. {q.question}</div>{q.options.map((opt,idx)=>{const letter=L[idx];const sel=answers[i]===letter;return(<div key={idx} className={'option'+(sel?' selected':'')} onClick={()=>select(i,letter)}><strong>{letter}.</strong> {opt}</div>)})}</div>)})}{!submitted?(<button className='btn' onClick={submit} disabled={answers.length!==quiz.total_questions}>Submit</button>):(<div className='card'><h3>Result</h3>{result?<p>Score: {result.score}/{result.total} ({result.percent.toFixed(1)}%) – emailed report sent.</p>:<p>Submitted.</p>}</div>)}</div>)}
